/**
 * Date: 26.10.2011
 * Time: 1:45:49
 * Author: 
 *   Sergey Serebryakov 
 *   sergey.serebryakoff@gmail.com
 */

package ru.goodsReview.storage.controller;

<<<<<<< HEAD
import org.springframework.jdbc.core.simple.SimpleJdbcTemplate;
import org.springframework.dao.DataAccessException;
import ru.goodsReview.storage.mappers.ProductMapper;
import ru.goodsReview.storage.mappers.CategoryMapper;
import ru.goodsReview.core.model.Product;
import ru.goodsReview.core.model.Category;
=======
import org.springframework.dao.DataAccessException;
import org.springframework.jdbc.core.simple.SimpleJdbcTemplate;
import ru.goodsReview.core.model.Category;
import ru.goodsReview.storage.mapper.CategoryMapper;
>>>>>>> 8b31582cae350551e2442ec6617239165d573275

import java.sql.Types;
import java.util.List;

<<<<<<< HEAD
/**
 * User: Sergey
 * Date: 26.10.2011
 * Time: 1:45:49
 */
=======
>>>>>>> 8b31582cae350551e2442ec6617239165d573275
public class CategoryDbController {
    private SimpleJdbcTemplate simpleJdbcTemplate;
    private CategoryMapper categoryMapper;

    public CategoryDbController(SimpleJdbcTemplate simpleJdbcTemplate) {
        this.simpleJdbcTemplate = simpleJdbcTemplate;
        this.categoryMapper = new CategoryMapper();
    }

<<<<<<< HEAD
    public void addCategory(Category category) {
=======
    public long addCategory(Category category) {
>>>>>>> 8b31582cae350551e2442ec6617239165d573275
        try {
            simpleJdbcTemplate.getJdbcOperations().update("INSERT INTO category (name, description, parent_category_id) VALUES(?,?,?)",
                    new Object[]{category.getName(), category.getDescription(), category.getParentCategoryId()},
                    new int[]{Types.VARCHAR, Types.VARCHAR, Types.INTEGER});
<<<<<<< HEAD
        } catch (DataAccessException e) {
            // We don't have permissions to update the table.
            // TODO(serebryakov): Log the error.
        }
=======
            long lastId = simpleJdbcTemplate.getJdbcOperations().queryForLong("SELECT LAST_INSERT_ID()");
            return lastId;
        } catch (DataAccessException e) {
            // We don't have permissions to update the table.
            // TODO(serebryakov): Log the error.
            e.printStackTrace();
        }
        return -1;
>>>>>>> 8b31582cae350551e2442ec6617239165d573275
    }

    public List<Category> getAllCategories() {
        List<Category> categories =
                simpleJdbcTemplate.getJdbcOperations().query("SELECT * FROM category", categoryMapper);
        return categories;
    }

    public Category getCategoryById(long category_id) {
        List<Category> categories =
                simpleJdbcTemplate.getJdbcOperations().query("SELECT * FROM category WHERE id = ?",
                        new Object[]{category_id},
                        new int[]{Types.INTEGER},
                        categoryMapper);
<<<<<<< HEAD
        return categories.get(0);
=======
        if (categories.size() > 0) {
            return categories.get(0);
        }
        return null;
>>>>>>> 8b31582cae350551e2442ec6617239165d573275
    }
}